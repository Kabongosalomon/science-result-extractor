section: title
Complex Embeddings for Simple Link Prediction
section: abstract
In statistical relational learning, the link prediction problem is key to automatically understand the structure of large knowledge bases. As in previous studies, we propose to solve this problem through latent factorization. However, here we make use of complex valued embeddings. The composition of complex embeddings can handle a large variety of binary relations, among them symmetric and antisymmetric relations. Compared to state-of-the-art models such as Neural Tensor Network and Holographic Embeddings, our approach based on complex embeddings is arguably simpler, as it only uses the Hermitian dot product, the complex counterpart of the standard dot product between real vectors. Our approach is scalable to large datasets as it remains linear in both space and time, while consistently outperforming alternative approaches on standard link prediction benchmarks. 1
section: Introduction
Web-scale knowledge bases (KBs) provide a structured representation of world knowledge, with projects such as DBPedia (, or the Google Knowledge Vault (). They enable a wide range of applications such as recommender systems, question answering or automated personal agents. The incompleteness of these KBs has stimulated research into predicting missing entries, a task known as link prediction that is one of the main problems in Statistical Relational Learning).
KBs express data as a directed graph with labeled edges (relations) between nodes (entities). Natural redundancies among the recorded relations often make it possible to fill in the missing entries of a KB. As an example, the relation CountryOfBirth is not recorded for all entities, but it can easily be inferred if the relation CityOfBirth is known. The goal of link prediction is the automatic discovery of such regularities. However, many relations are non-deterministic: the combination of the two facts IsBornIn(John,Athens) and IsLocatedIn(Athens,Greece) does not always imply the fact HasNationality(John,Greece). Hence, it is required to handle other facts involving these relations or entities in a probabilistic fashion.
To do so, an increasingly popular method is to state the link prediction task as a 3D binary tensor completion problem, where each slice is the adjacency matrix of one relation type in the knowledge graph. Completion based on low-rank factorization or embeddings has been popularized with the Netflix challenge (. A partially observed matrix or tensor is decomposed into a product of embedding matrices with much smaller rank, resulting in fixed-dimensional vector representations for each entity and relation in the database. For a given fact r(s,o) in which subject sis linked to object o through relation r, the score can then be recovered as a multi-linear product between the embedding vectors of s, rand o ().
Binary relations in KBs exhibit various types of patterns: hierarchies and compositions like FatherOf, OlderThan or IsPartOf-with partial/total, strict/non-strict orders-and equivalence relations like IsSimilarTo. As described in, a relational model should (a) be able to learn all combinations of these properties, namely reflexivity/irreflexivity, symmetry/antisymmetry and transitivity, and (b) be linear in both time and memory in order to scale to the size of present day KBs, and keep up with their growth.
Dot products of embeddings scale well and can naturally handle both symmetry and (ir-)reflexivity of relations; using an appropriate loss function even enables transitivity (. However, dealing with antisymmetric relations has so far almost always implied an explosion of the number of parameters) (see), making models prone to overfitting. Finding the best ratio between expressiveness and parameter space size is the keystone of embedding models.
In this work we argue that the standard dot product between embeddings can be a very effective composition function, provided that one uses the right representation. Instead of using embeddings containing real numbers we discuss and demonstrate the capabilities of complex embeddings. When using complex vectors, i.e. vectors with entries in C, the dot product is often called the Hermitian (or sesquilinear) dot product, as it involves the conjugate-transpose of one of the two vectors. As a consequence, the dot product is not symmetric anymore, and facts about antisymmetric relations can receive different scores depending on the ordering of the entities involved. Thus complex vectors can effectively capture antisymmetric relations while retaining the efficiency benefits of the dot product, that is linearity in both space and time complexity.
The remainder of the paper is organized as follows. We first justify the intuition of using complex embeddings in the square matrix casein which there is only a single relation between entities. The formulation is then extended to a stacked set of square matrices in a third-order tensor to represent multiple relations. We then describe experiments on large scale public benchmark KBs in which we empirically show that this representation leads not only to simpler and faster algorithms, but also gives a systematic accuracy improvement over current state-of-the-art alternatives.
To give a clear comparison with respect to existing approaches using only real numbers, we also present an equivalent reformulation of our model that involves only real embeddings. This should help practitioners when implementing our method, without requiring the use of complex numbers in their software implementation.
section: Relations as Real Part of Low-Rank Normal Matrices
In this section we discuss the use of complex embeddings for low-rank matrix factorization and illustrate this by considering a simplified link prediction task with merely a single relation type.
Understanding the factorization in complex space leads to a better theoretical understanding of the class of matrices that can actually be approximated by dot products of embeddings. These are the so-called normal matrices for which the left and right embeddings share the same unitary basis.
section: Modelling Relations
Let E be a set of entities with |E| = n. A relation between two entities is represented as a binary value Y so ∈ {−1, 1}, where s ∈ E is the subject of the relation and o ∈ E its object. Its probability is given by the logistic inverse link function:
where X ∈ R n×n is a latent matrix of scores, and Y the partially observed sign matrix.
Our goal is to find a generic structure for X that leads to a flexible approximation of common relations in real world KBs. Standard matrix factorization approximates X by a matrix product UV T , where U and V are two functionally independent n × K matrices, K being the rank of the matrix. Within this formulation it is assumed that entities appearing as subjects are different from entities appearing as objects. This means that the same entity will have two different embedding vectors, depending on whether it appears as the subject or the object of a relation. This extensively studied type of model is closely related to the singular value decomposition (SVD) and fits well to the case where the matrix X is rectangular. However, in many link prediction problems, the same entity can appear as both subject and object. It then seems natural to learn joint embeddings of the entities, which entails sharing the embeddings of the left and right factors, as proposed by several authors to solve the link prediction problem.
In order to use the same embedding for subjects and objects, researchers have generalised the notion of dot products to scoring functions, also known as composition functions, that combine embeddings in specific ways. We briefly recall several examples of scoring functions in Table 1, as well as the extension proposed in this paper.
Using the same embeddings for right and left factors boils down to Eigenvalue decomposition:
It is often used to approximate real symmetric matrices such as covariance matrices, kernel functions and distance or similarity matrices. In these cases all eigenvalues and eigenvectors live in the real space and E is orthogonal:. Scoring functions of state-of-the-art latent factor models fora given fact r(s, o), along with their relation parameters, time and space (memory) complexity. The embeddings es and eo of subject sand object o are in R K for each model, except for our model (ComplEx) where es, eo ∈ C K . Dis an additional latent dimension of the NTN model. F and F −1 denote respectively the Fourier transform and its inverse, and is the element-wise product between two vectors.
ET = E −1 . We are in this work however explicitly interested in problems where matrices -and thus the relations they represent -can also be antisymmetric. In that case eigenvalue decomposition is not possible in the real space; there only exists a decomposition in the complex space where embeddings x ∈ C K are composed of areal vector component Re(x) and an imaginary vector component Im(x). With complex numbers, the dot product, also called the Hermitian product, or sesquilinear form, is defined as:
where u and v are complex-valued vectors, i.e. u = Re(u) + iIm(u) with Re(u) ∈ R K and Im(u) ∈ R K corresponding to the real and imaginary parts of the vector u ∈ C K , and i denoting the square root of −1. We see here that one crucial operation is to take the conjugate of the first vector: ¯ u = Re(u) − iIm(u). A simple way to justify the Hermitian product for composing complex vectors is that it provides a valid topological norm in the induced vectorial space. For example, ¯ x T x = 0 implies x = 0 while this is not the case for the bilinear form x T x as there are many complex vectors for which x T x = 0.
Even with complex eigenvectors E ∈ C n×n , the inversion of E in the eigendecomposition of Equation leads to computational issues. Fortunately, mathematicians defined an appropriate class of matrices that prevents us from inverting the eigenvector matrix: we consider the space of normal matrices, i.e. the complex n × n matrices X, such that X ¯ X T = ¯ X TX. The spectral theorem for normal matrices states that a matrix X is normal if and only if it is unitarily diagonalizable:
where W ∈ C n×n is the diagonal matrix of eigenvalues (with decreasing modulus) and E ∈ C n×n is a unitary matrix of eigenvectors, with ¯ E representing its complex conjugate.
The set of purely real normal matrices includes all symmetric and antisymmetric sign matrices (useful to model hierarchical relations such as IsOlder), as well as all orthogonal matrices (including permutation matrices), and many other matrices that are useful to represent binary relations, such as assignment matrices which represent bipartite graphs. However, far from all matrices expressed as EW ¯ ET are purely real, and equation 1 requires the scores X to be purely real. So we simply keep only the real part of the decomposition:
In fact, performing this projection on the real subspace allows the exact decomposition of any real square matrix X and not only normal ones, as shown by.
Compared to the singular value decomposition, the eigenvalue decomposition has two key differences:
• The eigenvalues are not necessarily positive or real;
• The factorization is useful as the rows of E can be used as vectorial representations of the entities corresponding to rows and columns of the relation matrix X. Indeed, fora given entity, its subject embedding vector is the complex conjugate of its object embedding vector.
section: Low-Rank Decomposition
Ina link prediction problem, the relation matrix is unknown and the goal is to recover it entirely from noisy observations. To enable the model to be learnable, i.e. to generalize to unobserved links, some regularity assumptions are needed. Since we deal with binary relations, we assume that they have low sign-rank. The sign-rank of a sign matrix is the smallest rank of areal matrix that has the same sign-pattern as Y :
This is theoretically justified by the fact that the signrank is a natural complexity measure of sign matrices ( and is linked to learnability, and empirically confirmed by the wide success of factorization models ().
If the observation matrix Y is low-sign-rank, then our model can decompose it with a rank at most the double of the sign-rank of Y . That is, for any Y ∈ {−1, 1} n×n , there always exists a matrix X = Re(EW ¯ ET ) with the same sign pattern sign(X) = Y , where the rank of EW ¯ ET is at most twice the sign-rank of Y (.
Although twice sounds bad, this is actually a good upper bound. Indeed, the sign-rank is often much lower than the rank of Y . For example, the rank of then × n identity matrix I is n, but rank ± (I) = 3 (Alon et al., 2015). By permutation of the columns 2j and 2j + 1, the I matrix corresponds to the relation marriedTo, a relation known to be hard to factorize). Yet our model can express it in rank 6, for any n.
By imposing a low-rank K non EW ¯ ET , only the first K values of diag(W ) are non-zero. So we can directly have E ∈ C n×K and W ∈ C K×K . Individual relation scores X so between entities sand o can be predicted through the following product of their embeddings e s , e o ∈ C K :
We summarize the above discussion in three points:
1. Our factorization encompasses all possible binary relations.
2. By construction, it accurately describes both symmetric and antisymmetric relations.
3. Learnable relations can be efficiently approximated by a simple low-rank factorization, using complex numbers to represent the latent factors.
section: Application to Binary Multi-Relational Data
The previous section focused on modeling a single type of relation; we now extend this model to multiple types of relations. We do so by allocating an embedding w r to each relation r, and by sharing the entity embeddings across all relations.
Let Rand E be the set of relations and entities present in the KB. We want to recover the matrices of scores X r for all the relations r ∈ R. Given two entities sand o ∈ E, the log-odd of the probability that the fact r(s,o) is true is:
where φ is a scoring function that is typically based on a factorization of the observed relations and Θ denotes the parameters of the corresponding model. While X as a whole is unknown, we assume that we observe a set of true and false facts {Y rso } r(s,o)∈Ω ∈ {−1, 1} |Ω| , corresponding to the partially observed adjacency matrices of different relations, where Ω ⊂ R ⊗ E ⊗ E is the set of observed triples. The goal is to find the probabilities of entries Y r so being true or false fora set of targeted unobserved triples r (s , o ) / ∈ Ω.
Depending on the scoring function φ(s, r, o; Θ) used to predict the entries of the tensor X, we obtain different models. Examples of scoring functions are given in.
Our model scoring function is:
= Re(
where w r ∈ C K is a complex vector . These equations provide two interesting views of the model:
• Changing the representation: Equation (10) would correspond to DistMult with real embeddings, but handles asymmetry thanks to the complex conjugate of one of the embeddings 2 .
• Changing the scoring function: Equation (11) only involves real vectors corresponding to the real and imaginary parts of the embeddings and relations.
One can easily check that this function is antisymmetric when w r is purely imaginary (i.e. its real part is zero), and symmetric when w r is real. Interestingly, by separating the real and imaginary part of the relation embedding w r , we obtain a decomposition of the relation matrix X r as the sum of asymmetric matrix Re(E diag(Re(w r )) ¯ ET ) and a antisymmetric matrix Im(E diag(−Im(w r )) ¯ ET ). Relation embeddings naturally act as weights on each latent dimension: Re(w r ) over the symmetric, real part of e o , e s , and Im(w) over the antisymmetric, imaginary part of e o , e s . Indeed, one has e o , e s = e s , e o , meaning that Re(e o , e s ) is symmetric, while Im(e o , e s ) is antisymmetric. This enables us to accurately describe both symmetric and antisymmetric relations between pairs of entities, while still using joint representations of entities, whether they appear as subject or object of relations.
Geometrically, each relation embedding w r is an anisotropic scaling of the basis defined by the entity embeddings E, followed by a projection onto the real subspace.
section: Experiments
In order to evaluate our proposal, we conducted experiments on both synthetic and real datasets. The synthetic dataset is based on relations that are either symmetric or antisymmetric, whereas the real datasets comprise different types of relations found in different, standard KBs. We refer to our model as ComplEx, for Complex Embeddings.
section: Synthetic Task
To assess the ability of our proposal to accurately model symmetry and antisymmetry, we randomly generated a KB of two relations and 30 entities. One relation is entirely symmetric, while the other is completely antisymmetric. This dataset corresponds to a 2 × 30 × 30 tensor. shows apart of this randomly generated tensor, with asymmetric slice and an antisymmetric slice, decomposed into training, validation and test sets. The diagonal is unobserved as it is not relevant in this experiment.
The train set contains 1392 observed triples, whereas the validation and test sets contain 174 triples each. shows the best cross-validated Average Precision (area under Precision-Recall curve) for different factorization models of ranks ranging up to 50. Models were trained using Stochastic Gradient Descent with mini-batches and AdaGrad for tuning the learning rate), by minimizing the negative log-likelihood of the logistic model with L 2 regularization on the parameters Θ of the considered model:  on both relations as it has to push symmetric and antisymmetric patterns through the entity embeddings. Surprisingly, only our model succeeds on such simple data.
section: Datasets: FB15K and WN18
Dataset  We next evaluate the performance of our model on the FB15K and WN18 datasets. FB15K is a subset of Freebase, a curated KB of general facts, whereas WN18 is a subset of Wordnet, a database featuring lexical relations between words. We use original training, validation and test set splits as provided by. summarizes the metadata of the two datasets.
Both datasets contain only positive triples. As in Bordes et al. (2013b), we generated negatives using the local closed world assumption. That is, fora triple, we randomly change either the subject or the object at random, to form a negative example. This negative sampling is performed at runtime for each batch of training positive examples.
For evaluation, we measure the quality of the ranking of each test triple among all possible subject and object substitutions : r(s , o) and r(s, o ), ∀s , ∀o ∈ E. Mean Reciprocal Rank (MRR) and Hits at mare the standard evaluation measures for these datasets and come in two flavours: raw and filtered). The filtered metrics are computed after removing all the other positive observed triples that appear in either training, validation or test set from the ranking, whereas the raw metrics do not remove these.
Since ranking measures are used, previous studies generally preferred a pairwise ranking loss for the task). We chose to use the negative log-likelihood of the logistic model, as it is a continuous surrogate of the sign-rank, and has been shown to learn compact representations for several important relations, especially for transitive relations. In preliminary work, we tried both losses, and indeed the loglikelihood yielded better results than the ranking loss (except with TransE), especially on FB15K.
We report both filtered and raw MRR, and filtered Hits at 1, 3 and 10 in for the evaluated models. Furthermore, we chose TransE, DistMult and HolE as baselines since they are the best performing models on those datasets to the best of our knowledge (). We also compare with the CP model to emphasize empirically the importance of learning unique embeddings for entities. For experimental fairness, we reimplemented these methods within the same framework as the ComplEx model, using theano (). However, due to time constraints and the complexity of an efficient implementation of HolE, we record the original results for HolE as reported in Nickel et al. (2016b).
section: Results
WN18 describes lexical and semantic hierarchies between concepts and contains many antisymmetric relations such as hypernymy, hyponymy, or being "part of". Indeed, the DistMult and TransE models are outperformed hereby ComplEx and HolE, which are on par with respective filtered MRR scores of 0.941 and 0.938. shows the filtered test set MRR for the models considered and each relation of WN18, confirming the advantage of our model on antisymmetric relations while losing nothing on the others. 2D projections of the relation embeddings provided in Appendix B visually corroborate the results.
On FB15K, the gap is much more pronounced and the ComplEx model largely outperforms HolE, with a filtered MRR of 0.692 and 59.9% of Hits at 1, compared to 0.524 and 40.2% for HolE. We attribute this to the simplicity of our model and the different loss function. This is supported by the relatively small gap in MRR compared to DistMult (0.654); our model can in fact be interpreted as a complex number version of DistMult. On both datasets, TransE    and CP are largely left behind. This illustrates the power of the simple dot product in the first case, and the importance of learning unique entity embeddings in the second. CP performs poorly on WN18 due to the small number of relations, which magnifies this subject/object difference.
Reported results are given for the best set of hyper-parameters evaluated on the validation set for each model, after grid search on the following values: K ∈ {10, 20, 50, 100, 150, 200}, λ ∈ {0.1, 0.03, 0.01, 0.003, 0.001, 0.0003, 0.0}, α 0 ∈ {1.0, 0.5, 0.2, 0.1, 0.05, 0.02, 0.01}, η ∈ {1, 2, 5, 10} with λ the L 2 regularization parameter, α 0 the initial learning rate (then tuned at runtime with AdaGrad), and η the number of negatives generated per positive training triple. We also tried varying the batch size but this had no impact and we settled with 100 batches per epoch. Best ranks were generally 150 or 200, in both cases scores were always very close for all models. The number of negative samples per positive sample also had a large influence on the filtered MRR on FB15K (up to +0.08 improvement from 1 to 10 negatives), but not much on WN18. On both datasets regularization was important (up to +0.05 on filtered MRR between λ = 0 and optimal one). We found the initial learning rate to be very important on FB15K, while not so much on WN18. We think this may also explain the large gap of improvement our model provides on this dataset compared to previously published results -as DistMult results are also better than those previously reported -along with the use of the log-likelihood objective. It seems that in general AdaGrad is relatively insensitive to the initial learning rate, perhaps causing some overconfidence in its ability to tune the step size online and consequently leading to less efforts when selecting the initial step size.
Training was stopped using early stopping on the validation set filtered MRR, computed every 50 epochs with a maximum of 1000 epochs.
section: Influence of Negative Samples
We further investigated the influence of the number of negatives generated per positive training sample. In the previous experiment, due to computational limitations, the number of negatives per training sample, η, was validated among the possible numbers {1, 2, 5, 10}. We want to explore here whether increasing these numbers could lead to better results. To do so, we focused on FB15K, with the best validated λ, K, α 0 , obtained from the previous experiment. We then let η vary in {1, 2, 5, 10, 20, 50, 100, 200}.
section: Related Work
In the early age of spectral theory in linear algebra, complex numbers were not used for matrix factorization and mathematicians mostly focused on bi-linear forms). The eigen-decomposition in the complex domain as taught today in linear algebra courses came 40 years later. Similarly, most of the existing approaches for tensor factorization were based on decompositions in the real domain, such as the Canonical Polyadic (CP) decomposition. These methods are very effective in many applications that use different modes of the tensor for different types of entities. But in the link prediction problem, antisymmetry of relations was quickly seen as a problem and asymmetric extensions of tensors were studied, mostly by either considering independent embeddings or considering relations as matrices instead of vectors in the RESCAL model). Direct extensions were based on uni-,bi-and trigram latent factors for triple data, as well as a low-rank relation matrix ().
Pairwise interaction models were also considered to improve prediction performances. For example, the Universal Schema approach () factorizes a 2D unfolding of the tensor (a matrix of entity pairs vs. relations) while extend this also to other pairs.
In the Neural Tensor Network (NTN) model, combine linear transformations and multiple bilinear forms of subject and object embeddings to jointly feed them into a nonlinear neural layer. Its non-linearity and multiple ways of including interactions between embeddings gives it an advantage in expressiveness over models with simpler scoring function like DistMult or RESCAL. As a downside, its very large number of parameters can make the NTN model harder to train and overfit more easily.
The original multi-linear DistMult model is symmetric in subject and object for every relation and achieves good performance, presumably due to its simplicity. The TransE model from also embeds entities and relations in the same space and imposes a geometrical structural bias into the model: the subject entity vector should be close to the object entity vector once translated by the relation vector.
A recent novel way to handle antisymmetry is via the Holographic Embeddings (HolE) model by (). In HolE the circular correlation is used for combining entity embeddings, measuring the covariance between embeddings at different dimension shifts. This generally suggests that other composition functions than the classical tensor product can be helpful as they allow fora richer interaction of embeddings. However, the asymmetry in the composition function in HolE stems from the asymmetry of circular correlation, an O(nlog(n)) operation, whereas ours is inherited from the complex inner product, in O(n).
section: Conclusion
We described a simple approach to matrix and tensor factorization for link prediction data that uses vectors with complex values and retains the mathematical definition of the dot product. The class of normal matrices is a natural fit for binary relations, and using the real part allows for efficient approximation of any learnable relation. Results on standard benchmarks show that no more modifications are needed to improve over the state-of-the-art.
There are several directions in which this work can be extended. An obvious one is to merge our approach with known extensions to tensor factorization in order to further improve predictive performance. For example, the use of pairwise embeddings together with complex numbers might lead to improved results in many situations that involve non-compositionality. Another direction would be to develop a more intelligent negative sampling procedure, to generate more informative negatives with respect to the positive sample from which they have been sampled. It would reduce the number of negatives required to reach good performance, thus accelerating training time.
Also, if we were to use complex embeddings every time a model includes a dot product, e.g. in deep neural networks, would it lead to a similar systematic improvement?
