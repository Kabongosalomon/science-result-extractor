section: title
Asymmetric Tri-training for Unsupervised Domain Adaptation
section: abstract
Deep-layered models trained on a large number of labeled samples boost the accuracy of many tasks. It is important to apply such models to different domains because collecting many labeled samples in various domains is expensive. In un-supervised domain adaptation, one needs to train a classifier that works well on a target domain when provided with labeled source samples and unlabeled target samples. Although many methods aim to match the distributions of source and target samples, simply matching the distribution cannot ensure accuracy on the target domain. To learn discriminative representations for the target domain, we assume that artificially labeling target samples can result in a good representation. Tri-training leverages three classifiers equally to give pseudo-labels to unlabeled samples, but the method does not assume labeling samples generated from a different domain. In this paper, we propose an asymmetric tri-training method for unsupervised domain adaptation, where we assign pseudo-labels to unlabeled samples and train neural networks as if they are true labels. In our work, we use three networks asymmetrically. By asymmetric, we mean that two networks are used to label unlabeled target samples and one network is trained by the samples to obtain target-discriminative representations. We evaluate our method on digit recognition and sentiment analysis datasets. Our proposed method achieves state-of-the-art performance on the benchmark digit recognition datasets of domain adaptation.
section: Introduction
With the development of deep neural networks including deep convolutional neural networks (CNN) (, the recognition abilities of images and languages have improved dramatically. Training deep-layered networks with a large number of labeled samples enables us to correctly categorize samples in diverse domains. In addition, the transfer learning of CNN is utilized in many studies. For object detection or segmentation, we can transfer the knowledge of a CNN trained with a large-scale dataset by fine-tuning it on a relatively small dataset (). Moreover, features from a CNN trained on ImageNet () are useful for multimodal learning tasks including image captioning ( and visual question answering ().
One of the problems of neural networks is that although they perform well on the samples generated from the same distribution as the training samples, they may find it difficult to correctly recognize samples from different distributions at the test time. One example is images collected from the Internet, which may come in abundance and be fully labeled. They have a distribution different from the images taken from a camera. Thus, a classifier that performs well on various domains is important for practical use. To realize this, it is necessary to learn domain-invariantly discriminative representations. However, acquiring such representations is not easy because it is often difficult to collect a large number of labeled samples and because samples from different domains have domain-specific characteristics.
In unsupervised domain adaptation, we try to train a classifier that works well on a target domain on the condition that we are provided labeled source samples and unlabeled target samples during training. Most of the previous deep domain adaptation methods have been proposed mainly under the assumption that the adaptation can be realized by matching the distribution of features from different domains. These methods aimed to obtain domain-invariant features by minimizing the divergence between domains as well as a category loss on the source domain. However, as shown in, theoretically, if a classifier that works well on both the source and the target domains does not exist, we cannot expect a discriminative classifier for the target domain. That is, even if the distributions are matched on the nondiscriminative representations, the classifier may notwork
:$'1.0;"#-'"'./7#(8'7/$#34"'$*. Outline of our model. We assign pseudo-labels to unlabeled target samples based on the predictions from two classifiers trained on source samples.
well on the target domain. Since directly learning discriminative representations for the target domain, in the absence of target labels, is considered very difficult, we propose to assign pseudo-labels to target samples and train targetspecific networks as if they were true labels.
Co-training and tri-training () leverage multiple classifiers to artificially label unlabeled samples and retrain the classifiers. However, the methods do not assume labeling samples from different domains. Since our goal is to classify unlabeled target samples that have different characteristics from labeled source samples, we propose asymmetric tri-training for unsupervised domain adaptation. By asymmetric, we mean that we assign different roles to three classifiers.
In this paper, we propose a novel tri-training method for unsupervised domain adaptation, where we assign pseudolabels to unlabeled samples and train neural networks utilizing the samples. As described in, two networks are used to label unlabeled target samples and the remaining network is trained by the pseudo-labeled target samples. Our method does not need any special implementations. We evaluate our method on the digit classification task, traffic sign classification task and sentiment analysis task using the Amazon Review dataset, and demonstrate state-of-the-art performance in nearly all experiments. In particular, in the adaptation scenario, MNIST→SVHN, our method outperformed other methods by more than 10%.
section: Related Work
As many methods have been proposed to tackle various tasks in domain adaptation, we present details of the research most closely related to our paper.
A number of previous methods attempted to realize adaptation by utilizing the measurement of divergence between different domains). The methods are based on the theory proposed in, which states that the expected loss fora target domain is bounded by three terms: (i) expected loss for the source domain; (ii) domain divergence between source and target; and (iii) the minimum value of a shared expected loss. The shared expected loss means the sum of the loss on the source and target domain. As the third term, which is usually considered to be very low, cannot be evaluated when labeled target samples are absent, most methods try to minimize the first term and the second term. With regards to training deep architectures, the maximum mean discrepancy (MMD) or a loss of domain classifier network is utilized to measure the divergence corresponding to the second term (. However, the third term is very important in training CNN, which simultaneously extract representations and recognize them. The third term can easily be large when the representations are not discriminative for the target domain. Therefore, we focus on how to learn target-discriminative representations considering the third term. In () the focus was on the point we have stated and a target-specific classifier was constructed using a residual network structure. Different from their method, we constructed a target-specific network by providing artificially labeled target samples.
Several transductive methods use similarity of features to provide labels for unlabeled samples (). For unsupervised domain adaptation, in), a method was proposed to learn labeling metrics by using the k-nearest neighbors between unlabeled target samples and labeled source samples. In contrast to this method, our method explicitly and simply backpropagates the category loss for target samples based on pseudo-labeled samples. Our approach does not require any special modules.
Many methods proposed to give pseudo-labels to unlabeled samples by utilizing the predictions of a classifier and retraining it including the pseudo-labeled samples, which is called self-training. The underlying assumption of selftraining is that one's own high-confidence predictions are correct (. As the predictions are mostly correct, utilizing samples with high confidence will further improve the performance of the classifier. Co-training utilizes two classifiers, which have different views on one sample, to provide pseudo-labels). Then, the unlabeled samples are added to training set if at least one classifier is confident about the predictions. The generalization ability of co-training is theoretically ensured () under some assumptions and applied to various tasks). In (Chen et al., 2011), the idea of co-training was incorporated into domain adaptation. Tri-training can be regarded as the extension of co-training (). Similar to co-training, tritraining uses the output of three different classifiers to give pseudo-labels to unlabeled samples. Tri-training does not require partitioning features into different views; instead, tri-training initializes each classifier differently. However,
(--.-/01234-/56!+4/, * +-.-!/41708+594+47-$52:4$-/56!+4/,. The proposed method includes a shared feature extractor (F ), classifiers for labeled samples (F1, F2), which learn from labeled source samples, and newly labeled target samples. In addition, a target-specific classifier (Ft) learns from pseudo-labeled target samples. Our method first trains networks from only labeled source samples, then labels the target samples based on the output of F1, F2. We train all architectures using them as if they are correctly labeled samples.
tri-training does not assume that the unlabeled samples follow the different distributions from the ones which labeled samples are generated from. Therefore, we develop a tritraining method suitable for domain adaptation by using three classifiers asymmetrically.
In, the effect of pseudo-labels in a neural network was investigated. They argued that the effect of training a classifier with pseudo-labels is equivalent to entropy regularization, thus leading to a low-density separation between classes. In addition, in our experiment, we observe that target samples are separated in hidden features.
section: Method
In this section, we provide details of the proposed model for domain adaptation. We aim to construct a targetspecific network by utilizing pseudo-labeled target samples. Simultaneously, we expect two labeling networks to acquire target-discriminative representations and gradually increase accuracy on the target domain.
We show our proposed network structure in. Here F denotes the network which outputs shared features among three networks, F 1 and F 2 classify features generated from F . Their predictions are utilized to give pseudo-labels. The classifier F t classifies features generated from F , which is a target-specific network. Here F 1 , F 2 learn from source and pseudo-labeled target samples and F t learns only from pseudo-labeled target samples. The shared network F learns from all gradients from F 1 , F 2 , F t . Without such a shared network, another option for the network architecture we can think of is training three networks separately, but this is inefficient in terms of training and implementation. Furthermore, by building a shared network F , F 1 and F 2 can also harness the target-discriminative representations learned by the feedback from F t .
The set of source samples is defined as
∼ T , and the pseudolabeled target set is
section: Loss for Multiview Features Network
In the existing works (Chen et al., 2011) on co-training for domain adaptation, given features are divided into separate parts and considered to be different views.
As we aim to label target samples with high accuracy, we expect F 1 , F 2 to classify samples based on different viewpoints. Therefore, we make a constraint for the weight of F 1 , F 2 to make their inputs different to each other. We add the term |W 1 T W 2 | to the cost function, where W 1 , W 2 denote fully connected layers' weights of F 1 and F 2 which are first applied to the feature F (x i ). Each network will learn from different features with this constraint. The objective for learning F 1 , F 2 is defined as
where L y denotes the standard softmax cross-entropy loss function. We decided the trade-off parameter λ based on validation split.
section: Learning Procedure and Labeling Method
Pseudo-labeled target samples will provide targetdiscriminative information to the network. However, since they certainly contain false labels, we have to pickup reliable pseudo-labels. Our labeling and learning method is aimed at realizing this.
The entire procedure of training the network is shown in Algorithm 1. First, we train the entire network with source training set S. Here F 1 , F 2 are optimized by Eq. (1) and F t is trained on standard category loss. After training on S, to provide pseudo-labels, we use predictions of F 1 and F 2 , namely y 1 , y 2 obtained from x k . When C 1 , C 2 denote the class which has the maximum predicted probability for y 1 , y 2 , we assign a pseudo-label to x k if the following two conditions are satisfied. First, we require C 1 = C 2 to give pseudo-labels, which means two different classifiers agree with the prediction. The second requirement is that the maximizing probability of y 1 or y 2 exceeds the threshold parameter, which we set as 0.9 or 0.95 in the experiment.
We suppose that unless one of two classifiers is confident of the prediction, the prediction is not reliable. If the two requirements are satisfied,
is added to Tl . To prevent the overfitting to pseudo-labels, we resample the candidate for labeling samples in each step. We set the Algorithm 1 iter denotes the iteration of training. The function Labeling means the method of labeling. We assign pseudo-labels to samples when the predictions of F 1 and F 2 agree and at least one of them is confident of their predictions.
number of the initial candidates N init as 5,000. We gradually increase the number of the candidates N t = k/20 * n, where n denotes the number of all target samples and k denotes the number of steps, and we set the maximum number of pseudo-labeled candidates as 40,000. After the pseudo-labeled training set Tl is composed, F, F 1 , F 2 are updated by the objective Eq. (1) on the labeled training set L = S ∪ Tl . Then, F, F tare simply optimized by the category loss for Tl .
Discriminative representations will be learned by constructing a target-specific network trained only on target samples. However, if only noisy pseudo-labeled samples are used for training, the network may not learn useful representations. Then, we use both source samples and pseudo-labeled samples for training F, F 1 , F 2 to ensure the accuracy. Also, as the learning proceeds, F will learn target-discriminative representations, resulting in an improvement inaccuracy in F 1 , F 2 . This cycle will gradually enhance the accuracy in the target domain.
section: Batch Normalization for Domain Adaptation
Batch normalization (BN), which whitens the output of the hidden layer in a CNN, is an effective technique to accelerate training speed and enhance the accuracy of the model. In addition, in domain adaptation, whitening the hidden layer's output is effective for improving the performance, which make the distribution in different domains similar.
Input samples of F 1 , F 2 include both pseudo-labeled target samples and source samples. Introducing BN will be useful for matching the distribution and improves the performance. We add the BN layer in the last layer in F .
section: Analysis
In this section, we provide a theoretical analysis to our approach. First, we provide an insight into existing theory, then we introduce a simple expansion of the theory related to our method.
In, an equation was introduced showing that the upper bound of the expected error in the target domain depends on three terms, which include the divergence between different domains and the error of an ideal joint hypothesis. The divergence between source and target domain, H∆H-distance, is defined as follows:
This distance is frequently used to measure the adaptability between different domains.
The ideal joint hypothesis is defined ash * = arg min
, and its corresponding error
, where R denotes the expected error on each hypothesis. The theorem is as follows.
section: Theorem 1. (Ben-David et al., 2010)
Let H be the hypothesis class. Given two different domains S, T , we have
This theorem means that the expected error on the target domain is upper bounded by three terms, the expected error on the source domain, the domain divergence measured by the disagreement of the hypothesis, and the error of the ideal joint hypothesis. In the existing work), C was disregarded because it was considered to be negligibly small. If we are provided with fixed features, we do not need to consider the term because the term is also fixed. However, if we assume that x s ∼ S, x t ∼ T are obtained from the last fully connected layer of deep models, we note that C is determined by the output of the layer, and further note the necessity of considering this term.
We consider the pseudo-labeled target samples set
given false labels at the ratio of ρ. The shared error of h * on S, Tl is denoted as C ′ . Then, the following inequality holds:
We show a simple derivation of the inequality in the Supplementary material. In Theorem 1, we cannot measure C in the absence of labeled target samples. We can approximately evaluate and minimize it by using pseudo-labels.
] is expected to below, although we use the training set Tl instead of genuine labeled target samples. Thus, our method will consider both the second and the third term in Theorem 1.
section: Experiment and Evaluation
We perform extensive evaluations of our method on image datasets and a sentiment analysis dataset. We evaluate the accuracy of target-specific networks in all experiments.
Visual Domain Adaptation For visual domain adaptation, we perform our evaluation on the digits datasets and traffic signs datasets.
Digits datasets include MNIST ( We do not evaluate our method on Office (, which is the most commonly used dataset for visual domain adaptation. As pointed out by, some labels in that dataset are noisy and some images contain other classes' objects. Furthermore, many previous studies have evaluated the fine-tuning of pretrained networks using ImageNet. This protocol assumes the existence of another source domain. In our work, we want to evaluate the situation where we have access to only one source domain and one target domain.
Adaptation in Amazon Reviews To investigate the behavior on language datasets, we also evaluated our method on the Amazon Reviews dataset () with the same preprocessing as used by). The dataset contains reviews on four types of products: books, DVDs, electronics, and kitchen appliances. We evaluate our method on 12 domain adaptation scenarios. The results are shown in.) in the Amazon Reviews experiment.
section: Baseline Methods
section: Implementation Detail
In experiments on image datasets, we employ the architecture of CNN used in). For a fair comparison, we separate the network at the hidden layer from which () constructed discriminator networks. Therefore, when considering one classifier, for example, F 1 • F , the architecture is identical to previous work. We also follow) in the other protocols. We set the threshold value for the labeling method as 0.95 in MNIST→SVHN. In other scenarios, we set it as 0.9. We use MomentumSGD for optimization and set the momentum as 0.9, while the learning rate is determined on validation splits and uses either [0.01, 0.05]. λ is set 0.01 in all scenarios. In our Supplementary material, we provide details of the network architecture and hyper-parameters.
For experiments on the Amazon Reviews dataset, we use a similar architecture to that used in (: with sigmoid activated, one dense hidden layer with 50 hidden units, and softmax output. We extend the architecture to our method similarly in the architecture of CNN. λ is set as 0.001 based on the validation. Since the input is sparse, we use Adagrad (Duchi et al., 2011) for optimization. We repeat this evaluation 10 times and report mean accuracy.
section: Experimental Result
In MNIST→MNIST-M: last pooling layer MNIST→MNIST-M First, we evaluate the adaptation scenario between the hand-written digits dataset MNIST and its transformed dataset MNIST-M. MNIST-M is composed by merging the clip of the background from BSDS500 datasets (). A patch is randomly taken from the images in BSDS500, merged to MNIST digits. Even with this simple domain shift, the adaptation performance of CNN is much worse than the case where it was trained on target samples. From 59,001 target training samples, we randomly select 1,000 labeled target samples as a validation split and tuned hyper-parameters.
Our method outperforms the other existing method by about 7%. Visualization of features in the last pooling layer is shown in. We can observe that the red target samples are more dispersed when adaptation is achieved. We show the comparison of the accuracy between the actual labeling accuracy on target samples during training and the test accuracy in. The test accuracy is very low at first, but as the steps increase, the accuracy becomes closer to that of the labeling accuracy. In this adaptation, we can clearly see that the actual labeling accuracy gradually improves with the accuracy of the network.
SVHN↔MNIST We increase the gap between distributions in this experiment.  centered in images, thus adaptation from MNIST to SVHN is rather difficult. In both settings, we use 1,000 labeled target samples to find the optimal hyperparameters.
We evaluate our method on both adaptation scenarios and achieved state-of-the-art performance on both datasets. In particular, for the adaptation MNIST→SVHN, we outperformed other methods by more than 10%. In, we visualize the representations in MNIST→SVHN. Although the distributions seem to be separated between domains, the red SVHN samples become more discriminative using our method compared with non-adapted embedding. We also show the comparison between actual labeling method accuracy and testing accuracy in. In this we can see that the labeling accuracy rapidly drops in the initial adaptation stage. On the other hand, testing accuracy continues to improve, and finally exceeds the labeling accuracy. There are two questions about this interesting phenomenon. The first question is why does the labeling method continue to decrease despite the increase in the test accuracy? Target samples given pseudo-labels always include mistakenly labeled samples whereas those given no labels are ignored in our method. Therefore, the error will be reinforced in the target samples that are included in training set. The second question is why does the test accuracy continue to increase despite the lower labeling accuracy? The assumed reasons are that the network already acquires target discriminative representations in this phase and they can improve the accuracy using source samples and correctly labeled target samples.
In, we also show the comparison of accuracy of the three networks F 1 , F 2 , F tin SVHN→MNIST. The accuracy of three networks is nearly the same in every step. The same thing is observed in other scenarios. From this result, we can state that the target-discriminative representations are shared in all three networks. Our method also outperforms other methods in this experiment. In this experiment, the effect of BN is not clear compared with other scenarios. The domain gap is considered small in this scenario as the performance of the source-only classifier shows. In, although the labeling accuracy is dropping, the accuracy of the learned network's prediction is improving as in MNIST↔SVHN.
section: SYN DIGITS→SVHN
SYN SIGNS→GTSRB This setting is similar to the pre-
section: Gradient stop branch
Ft F1, F2 None MNIST→MNIST-M 56.4 95.4 94.0 MNIST→SVHN 47.7 47.5 52.8 SYN SIGNS→GTRB 96.5 93.1 96.2. Results of Gradient stop experiment. When stopping gradients from Ft, we do not use backward gradients from Ft to F , and F learns only from F1, F2. When stopping gradients from F1, F2, we do not use backward gradients from F1, F2 to F , and F learns from Ft. None denotes our proposed method, we backward all gradients from all branches to F . In these three adaptation scenarios, our method shows stable performance.
vious setting, adaptation from synthetic images to real images, but we have a larger number of classes, namely 43 classes instead of 10. We use the SYN SIGNS dataset) for the source dataset and the GTSRB dataset) for the target dataset, which consist of real traffic sign images. We select randomly 31,367 samples for target training samples and evaluate accuracy on the rest of the samples. A total of 3,000 labeled target samples are used for validation.
In this scenario, our method outperforms other methods. This result shows that our method is effective for the adaptation from synthesized images to real images, which have diverse classes. In, the same tendency as in MNIST↔SVHN is observed in this adaptation scenario.
section: Gradient Stop Experiment
We evaluate the effect of the target-specific network in our method. We stop the gradient from upper layer networks F 1 , F 2 , and F t to examine the effect of F t . shows three scenarios including the case where we stop the gradient from F 1 , F 2 , and F t . In all scenarios, when we backward all gradients from F 1 , F 2 , F t , we obtain clear performance improvements.
In the experiment MNIST→MNIST-M, we can assume that only the backpropagation from F 1 , F 2 cannot construct discriminative representations for target samples and confirm the effect of F t . For the adaptation MNIST→SVHN, the best performance is realized when F receives all gradients from upper networks. Backwarding all gradients will ensure both target-specific discriminative representations in difficult adaptations. In SYN SIGNS→GTSRB, backwarding only from F t produces the worst performance because these domains are similar and noisy pseudo-labeled target samples worsen the performance.
section: A-distance
From the theoretical results in, A-distance is usually used as a measure of domain discrepancy. The way of estimating empirical A-distance is simple, in which we train a classifier to classify a domain from each domains' feature. Then, the approximate distance is calculated   asˆdasˆ asˆd A = 2(1 − 2ǫ), where ǫ is the generalization error of the classifier. In, we show the A-distance calculated from each CNN features. We used linear SVM to calculate the distance. From this graph, we can see that our method certainly reduces the A-distance compared with the CNN trained on only source samples. In addition, when comparing DANN and our method, although DANN reduces A-distance much more than our method, our method shows superior performance. This indicates that minimizing the domain discrepancy is not necessarily an appropriate way to achieve better performance.
Amazon Reviews Reviews are encoded in 5,000 dimensional vectors of bag-of-words unigrams and bigrams with binary labels. Negative labels are attached to the samples if they are ranked with 1-3 stars. Positive labels are attached if they are ranked with 4 or 5 stars. We have 2,000 labeled source samples and 2,000 unlabeled target samples for training, and between 3,000 and 6,000 samples for testing. We use 200 of labeled target samples for validation.
From the results in, our method performs better than VFAE () and DANN () in nine settings out of twelve. Our method is effective in learning a shallow network on different domains.
section: Conclusion
In this paper, we have proposed a novel asymmetric tri-training method for unsupervised domain adaptation, which is simply implemented. We aimed to learn discriminative representations by utilizing pseudo-labels assigned to unlabeled target samples. We utilized three classifiers, two networks assign pseudo-labels to unlabeled target samples and the remaining network learns from them.
We evaluated our method both on domain adaptation on a visual recognition task and a sentiment analysis task, outperforming other methods. In particular, our method outperformed the other methods by more than 10% in the MNIST→SVHN adaptation task.
section: Acknowledgement
section: Proof of Theorem
We introduce the derivation of theorem of the main paper. The ideal joint hypothesis is defined ash * = arg min
, and its corresponding error
, where R denotes the expected error on each hypothesis.
We consider the pseudo-labeled target samples set
given false labels at the ratio of ρ. The minimum shared error on S, Tl is denoted as C ′ . Then, the following inequality holds:
Proof. The probabiliy of false labels in the pseudo-labeled set Tl is ρ. When we consider 0-1 loss function for l, the difference between the error based on the true labeled set and pseudo-labeled set is
Then, the difference in the expected error is,
From the characteritic of the loss function, the triangle inequality will hold, then
From this result, the main inequality holds.
section: CNN Architectures and training detail
Four types of architectures are used for our method, which is based on). The network topology is shown in Figs 6, 7 and 8. The other hyperparameters are decided on the validation splits. The learning rate is set to 0.05 in SVHN↔MNIST. In the other scenarios, it is set to 0.01. The batchsize for training F t , F is set as 128, the batchsize for training F 1 , F 2 , F is set as 64 in all scenarios.
In MNIST→MNIST-M, the dropout rate used in the experiment is 0.2 for training F t , 0.5 for training F 1 , F 2 . In MNIST→SVHN, we did not use dropout. We decreased learning rate to 0.001 after step 10. In SVHN→MNIST, the dropout rate used in the experiment is 0.5. In SYNDIGITS→SVHN, the dropout rate used in the experiment is 0.5. In SYNSIGNS→GTSRB, the dropout rate used in the experiment is 0.5.
section: Supplementary experiments on MNIST→MNIST-M
We observe the behavior of our model when increasing the number of steps up to one hundred. We show the result in. Our model's accuracy gets about 97%. In our main experiments, we set the number of steps thirty, but from this experiment, further improvements can be expected.. The architecture used for MNIST→MNIST-M. We added BN layer in the last convolution layer and FC layers in F1, F2. We also used dropout in our experiment.. The architecture used in the adaptation Synthetic Signs→GTSRB. We added a BN layer after the last convolution layer in F and also used dropout.
